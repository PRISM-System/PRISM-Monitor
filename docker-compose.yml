version: '3.8' # Docker Compose 파일 형식 버전 지정

services:
  # 서비스 이름 (원하는 이름으로 변경 가능)
  fastapi-app:
    # 이 서비스의 빌드 컨텍스트는 현재 디렉토리(Dockerfile이 있는 곳)임을 명시
    build: .
    
    # .env 파일에서 환경 변수를 로드하도록 지정
    env_file:
      - .env
      
    # 컨테이너의 8001 포트를 호스트의 8001 포트에 매핑
    # Uvicorn이 8001 포트로 실행되므로, 이 포트를 외부로 노출
    ports:
      - "8001:8001"
      
    # 컨테이너가 비정상적으로 종료될 경우 자동으로 재시작하도록 설정
    restart: always
    
    # Dockerfile의 CMD를 오버라이드하지 않고 그대로 사용
    # CMD ["pipenv", "run", "uvicorn", "main:app", "--host", "0.0.0.0", "--port", "8001"]